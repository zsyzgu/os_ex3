### 个人思考题

#### 请简要分析最优匹配，最差匹配，最先匹配，buddy system分配算法的优势和劣势，并尝试提出一种更有效的连续内存分配算法 (w3l1)

分配算法| 最先匹配（First-fit）| 最佳匹配（Best-fit）| 最差匹配（Worst-fit) | 伙伴系统（Buddy System）
------ | ------------------ | --------------- | ----------------
优势 | 简单、在高地址空间有大块的空闲分区 | 大部分分配的尺寸较小时效果最好 | 中等大小的分配较多时效果最好、避免出现太多的小碎片 | 能很好地解决外部碎片问题
劣势 | 会产生外部碎片、分配大块时较慢 | 会产生外部碎片、释放分区过程较慢 | 会产生外部碎片、释放分区过程较慢、容易破坏大的空闲分区，因此后续难以分配大的分区 | 分区大小只能是2的整数次幂，可能产生资源浪费

### “连续内存分配”与视频相关的课堂练习

#### 5.1 计算机体系结构和内存层次

##### MMU的工作机理？

内存管理单元（MMU，Memory Management Unit）是CPU中用来管理虚拟存储器、物理存储器的控制线路，主要工作为将虚拟地址映射为物理地址，以及提供硬件机制的内存访问授权，多用户多进程操作系统等。

MMU工作机理：

1.操作系统在初始化或分配、释放内存时会执行一些指令在物理内存中填写页表，然后用指令设置MMU，告诉MMU页表在物理内存中的什么位置。

2.MMU设置好之后，CPU每次执行访问内存的指令都会自动引发MMU做查表和地址转换操作。该操作由硬件自动完成，不需要指令控制。

##### L1和L2高速缓存有什么区别？

L1 Cache(一级缓存)是CPU第一层高速缓存。位于CPU内核的旁边，是与CPU结合最为紧密的CPU缓存。
内置的L1高速缓存的容量和结构对CPU的性能影响较大，不过高速缓冲存储器均由静态RAM组成，结构较复杂，在CPU管芯面积不能太大的情况下，L1级高速缓存的容量不可能做得太大。
一般L1缓存的容量通常在32—256KB。

L2 Cache(二级缓存)是CPU的第二层高速缓存，它是处理器内部的一些缓冲存储器，其作用跟内存一样。分内部和外部两种芯片。内部的芯片二级缓存运行速度与主频相同，而外部的二级缓存则只有主频的一半。
L2高速缓存容量也会影响CPU的性能，原则是越大越好,普通台式机CPU的L2缓存一般为128KB到2MB或者更高，笔记本、服务器和工作站上用CPU的L2高速缓存最高可达1MB-3MB。

L3 Cache(三级缓存)分为两种，早期的是外置，现在的都是内置的。L3缓存的应用可以进一步降低内存延迟，同时提升大数据量计算时处理器的性能。

#### 5.2 地址空间和地址生成

##### 编译、链接和加载的过程了解？

编译时 | 加载时 | 执行时
----- | ----- | -----
假设起始地址已知、如果起始地址改变,必须重新编译 | 编译时起始位置未知、编译器需生成可重定位的代码,加载时生成绝对地址 | 执行时代码可移动,需要地址转换（映射）硬件支持

##### 动态链接如何使用？

在可执行文件装载时或运行时，由操作系统的装载程序加载库。大多数操作系统将解析外部引用（比如库）作为加载过程的一部分。在这些系统上，可执行文件包含一个叫做import directory的表，该表的每一项包含一个库的名字。根据表中记录的名字，装载程序在硬盘上搜索需要的库，然后将其加载到内存中预先不确定的位置，之后根据加载库后确定的库的地址更新可执行程序。可执行程序根据更新后的库信息调用库中的函数或引用库中的数据。

#### 5.3 连续内存分配

##### 什么是内碎片、外碎片？

内存碎片指不能被利用的空闲内存,根据产生位置的不同，又分为外部碎片和内部碎片。

外部碎片指分配单元之间的未被使用内存；

内部碎片指分配单元内部的未被使用内存，取决于分配单元大小是否要取整。

##### 为什么最先匹配会越用越慢？

在最先匹配算法（First-fit）中，空闲分区列表按地址顺序排序，每次分配n个字节，使用第一个地址空间比n大的空闲块。因此，进行多次分配以后，低地址空间存在大量外部碎片，此时再进行较大空闲块的分配时，速度就会变慢。

##### 为什么最差匹配会的外碎片少？

在最差匹配算法（Worst-fit）中，每次分配n个字节，使用尺寸不小于n的最大的空闲块。这样一来，每次分配空闲分区，都从最大都空闲分区进行拆分，使得产生的外碎片不会太小。尤其是在中等大小的分配较多的情况下，最差匹配产生的外碎片最少。

##### 在几种算法中分区释放后的合并处理如何做？

最先匹配（First-fit）| 最佳匹配（Best-fit）| 最差匹配（Worst-fit)
------------------ | ----------------- | ------------------
释放时，查找并且合并临近的空闲分区 | 释放时，查找并且合并临近的空闲分区，并调整空闲分区列表顺序 | 释放时，查找并且合并临近的空闲分区，并调整空闲分区列表顺序

#### 5.4 碎片整理

##### 一个处于等待状态的进程被对换到外存（对换等待状态）后，等待事件出现了。操作系统需要如何响应？



#### 5.5 伙伴系统

##### 伙伴系统的空闲块如何组织？

伙伴系统的空闲块按大小和起始地址组成二维数组，其中空闲块的大小只能是2的整数次幂。初始状态只有一个大小为2的u次幂的内存块。

##### 伙伴系统的内存分配流程？

分配时，由小到大在空闲块数组中找最小的可用空闲块。如果空闲块过大，对可用空闲块进行二等分，直到得到合适的可用空闲块。

##### 伙伴系统的内存回收流程？

释放分区时，把释放的块放入空闲块数组，合并满足合并条件的空闲块。

其中合并条件为:
1.大小相同;
2.地址相邻;
3.起始地址较小的块的起始地址必须是2的i+1次幂的倍数。

##### struct list_entry是如何把数据元素组织成链表的？

List_entry先按大小对空闲分区进行排序，相同大小的空闲分区再按起始地址进行排序。

